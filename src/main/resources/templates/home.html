<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head>
        <title th:text="#{app.title}"> Title </title>
        <link rel="stylesheet" th:href="@{/css/styles.css}"/>
        
        <!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
	integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
	crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
	integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	crossorigin="anonymous"></script>
	
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    </head>
	<body onload="onLoadEvents()">
		<input id="custIDUniversal" type="hidden">
	
		<h1 >BalanceApp</h1>
	   <button id="allcustomer" class="btn btn-primary" onclick="getAllCustomer()">GET ALL CUSTOMER</button>
	     <button id="addCustomer" class="btn btn-primary"  >Add Customer</button>
	     <div id="successMsg" style="margin-left: 43em;color: crimson;"></div>
	     <table class="table table-striped table-hover" style="width: 1420px;" id="CustDatatable"/></div>
	     
	      <!-- Modal for credited Bill-->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title container text-center">Credited Bill</h4>
        </div>
  <form action="">
        <div class="modal-body">
        	<input id="custIdModelData" type="hidden">
        <div class="col-md-6 form-group">
			<label>custFName:</label><input type="text"  id="custFName" name="custFName"  class="form-control"/>
			</div>
			
			  <div class="col-md-6 form-group">
			<label>custLName:</label><input type="text"  id="custLName" name="custLName"  class="form-control"/>
			</div>
			
			
			 <div class="col-md-6 form-group">
			<label>creditAmount:</label><input type="text"  id="creditAmount" name="creditAmount"  class="form-control"/>
			</div>
			 <div class="col-md-6 form-group">
			<label>creditDate:</label><input type="text"  id="creditDate" name="creditDate"  class="form-control"/>
			</div>
        
        
        </div>
        
      
        </form>
				<div class="modal-footer">
            <button  id="addCredit" type="button" class="btn btn-primary"  onclick="addCreditBil()">add</button>
          <button id="closeModel" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>	     
	      <!-- Modal End-->
	      
	      	      <!-- Modal for Debited Bill-->
  <div class="modal fade" id="myModalDebit" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title container text-center">Debited Bill</h4>
        </div>
  <form id="debitBillForm" action="">
        <div class="modal-body">
        	<input id="custIdDebitModelData" type="hidden">
        <div class="col-md-6 form-group">
			<label>custFName:</label><input type="text"  id="custFNameDebit" name="custFNameDebit"  class="form-control"/>
			</div>
			
			  <div class="col-md-6 form-group">
			<label>custLName:</label><input type="text"  id="custLNameDebit" name="custLNameDebit"  class="form-control"/>
			</div>
			
			
			 <div class="col-md-6 form-group">
			<label>Bill Amount:</label><input type="text"  id="billAmount" name="billAmount"  class="form-control"/>
			</div>
			
			 <div class="col-md-6 form-group">
			<label>Bill Date:</label><input type="text"  id="billDate" name="billDate"  class="form-control"/>
			</div>
        
        </div>
        
      
        </form>
				<div class="modal-footer">
            <button  id="addDebit" type="button" class="btn btn-primary"  onclick="addDebitedBil()">add</button>
          <button id="closeModelDebit" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>	     
	      <!-- Modal End-->
	      
	</body>
	<script
  src = "https://code.jquery.com/jquery-3.3.1.min.js"
  integrity = "sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin = "anonymous"></script>
  
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css"/>
 
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script> 
<script type="text/javascript">
	/*<![CDATA[*/
		
// 		$('#allcustomer').click(function(e) {
// 		e.preventDefault(); 
// 		alert("getAllCustomer");
 function  getAllCustomer(){
		$.ajax({
			type : "GET",
			url : '/BalanceApp/customer/getAllCustomer',
			success: function(result){

// 				console.log("Success: ", result[0].custFName);
// 				console.log("Success: ", result);
				var dataArr = [];
				  $.each(result, function (key, value) {
					  var dataArray = [];
					  dataArray.push(value.custId);
				        dataArray.push(value.custFName);
				        dataArray.push(value.custLName);
				        dataArray.push(value.city);
				        dataArray.push(value.state);
				        dataArray.push(value.contact);
				        dataArray.push(value.totalDue);
				        dataArray.push("<div class=\"btn-group\" style=\"margin-left: 6em;\"><button data-toggle=\"modal\" data-target=\"#myModal\" class=\"btn btn-warning\" onclick=\"getRowData(),getClearUnwantedField()\" >Credited Bill</button><button  data-toggle=\"modal\" data-target=\"#myModalDebit\"  class=\"btn btn-danger\" onclick=\"getRowData(),getClearUnwantedField()\"  >Debited Bill</button><button   class=\"btn btn-primary\" onclick=\"getDetailsPage()\">Get Details</button></div>")
				        dataArr.push(dataArray);
				        console.log(dataArray);
				        
				  });
				  getTable(dataArr);
			}
		});	

 }
// 		alert("getAllCustomerEnd");
// 		});	
	
	function getTable(dataArr) {
	    $('#CustDatatable').DataTable({
	    	destroy: true,
	        data: dataArr,
	        columns: [
	        	{ title: "Id" },
	            { title: "Fist Name" },
	            { title: "Last Name" },
	            { title: "city" },
	            { title: "State" },
	            { title: "contact" },
	            { title: "TotalDue" },
	            { title: "Action" }
	        ]
	    });
	}
	
	$('#addCustomer').click( function(event) {
		   event.preventDefault();
		   window.location.href= "/BalanceApp/customer/add-customer";
		});
	
	
	function addCreditBil(){
		console.log("serialize:-->>"+$("form").serialize());
		var serializeObject=$("form").serialize();
		var custIdModelData=$("#custIdModelData").val();
		console.log("serialize:-object->>"+serializeObject);
		var urlForBill='/BalanceApp/creditedBill/addCreditedBill?'+serializeObject+'&custId='+custIdModelData;
		console.log("url->>"+urlForBill);
		$.ajax({
			type : "GET",
			url :urlForBill ,
			success: function(result){
// alert("credited bill called");
// alert(result);
$('#successMsg').html(result);
$('#closeModel').click();
getAllCustomer();
// 				console.log("Success: ", result[0].custFName);
// 				console.log("Success: ", result);
				
				        
				  }
			});
		}
	
	function addDebitedBil(){
		console.log("addDebitedBil");
		var serializeObject=$("#debitBillForm").serialize();
		console.log("serializeObject-->>"+serializeObject);
		var custIdDebitModelData=$("#custIdDebitModelData").val();
		var urlForBill='/BalanceApp/debitedBill/addBill?'+serializeObject+'&custId='+custIdDebitModelData;
		$.ajax({
			type : "GET",
			url :urlForBill ,
			success: function(result){
// alert("credited bill called");
// alert(result);
$('#successMsg').html(result);
$('#closeModelDebit').click();
getAllCustomer();
// 				console.log("Success: ", result[0].custFName);
// 				console.log("Success: ", result);
				
				        
				  }
			});
	}
	
	function getRowData(){
	console.log("getRowData");

	  var table = $('#CustDatatable').DataTable();
	    $('#CustDatatable tbody').on('click', 'tr', function () {
	    	$("#custIdModelData").val(table.row(this).data()[0]);
	    	$('#custFName').val(table.row(this).data()[1]);
	    	$('#custLName').val(table.row(this).data()[2]);
	    	$("#custIdDebitModelData").val(table.row(this).data()[0]);
	    	$('#custFNameDebit').val(table.row(this).data()[1]);
	    	$('#custLNameDebit').val(table.row(this).data()[2]);
	    	$('#custIDUniversal').val(table.row(this).data()[0]);
	    });
	}
	
	function onLoadEvents(){
		console.log("onLoadEvents");
		$("#custIdModelData").val("");
    	$('#custFName').val("");
    	$('#custLName').val("");
	}
	
	function getClearUnwantedField(){
		$("#creditDate").val("");
    	$('#creditAmount').val("");
    	$("#billAmount").val("");
    	$('#billDate').val("");
    	$("#billClearDate").val("");
    	$('#due').val("");
    	$('#dateCount').val("");
    	
	}
	
	function getDetailsPage(){
		getRowData();
		
		var custIDUniversal="";
		custIDUniversal=setTimeout(function(){ $('#custIDUniversal').val();}, 2000);
	
	alert("custIDUniversal-->>"+custIDUniversal);
		if(custIDUniversal!=0){
			  window.location.href= "/BalanceApp/customer/getDetailsPage?custId="+custIDUniversal;
		}
		
	}
	
	function getuniversalId(){
		alert("getuniversalId");
		$('#custIDUniversal').val();
	}
	
	/*]]>*/
	</script>
	
</html>